<p>[toc]</p>


<p>Apigee API proxies are implemented as 'bundles' of configuration files, including policies, and (optionally) custom scripts and code. The configurations files define a processing pipeline for requests and responses that flow from clients apps to 'backend services'.</p>

<p>A backend service in this context refers to any Web service or API that exposed over HTTP. Often, a single API proxy invokes more than one backend service. API proxies are useful for implementing intermediary services that compose data and capabilities from multiple sources to expose innovative and unified APIs to app developers, without requiring development teams to modify any application code.</p>

<p>For developers, one great benefit of the API Platform is its ability to manage APIs that are not necessarily under your control. As you will see in the Developer Guide topics, you can build API proxies that modify the behavior of publicly available APIs. The topics and associated API Platform samples demonstrate interactions with Yahoo weather APIs, Google geocoding and elevation APIs, Twitter, and Microsoft Azure's translation API.</p>

<p>This means that if an API does not meet your requirements, you can build a proxied version of the API that does. For example, if an API only returns XML, but you require JSON, you can simply build an API proxy that performs the conversion. You then build your apps to invoke the proxied URL instead of directly calling the provider's API. You can also share this URL with fellow developers and become an API provider yourself.</p>
	
<p>You can create and develop API proxies using the Management UI, or using development tools on your local machine. API proxies developed locally can be imported and deployed on the API Platform for runtime testing and production.</p>

<p>Developing API proxies is an iterative process. You should plan to modify, deploy, and test API proxies frequently as you go along. Apigee provides tools to assist in this process.</p>

<h2>Create an API proxy</h2>

<table border="1" cellpadding="1" cellspacing="1" class="table" style="width: 500px; background-color: #f5f5f5;">
	<tbody>
		<tr>
			<td><strong>Tutorial Counterpart</strong><br>
				You can also create an API proxy in the API Platform Management UI. See&nbsp;<a href="/docs/enterprise/content/secure-calls-your-api-through-api-key-validation#step1">step 1</a>&nbsp;In the tutorial, "Add and configure your first API".</td>
		</tr>
	</tbody>
</table>

<p>In the following steps, you create a simple API proxy that acts as a facade to the Yahoo Weather API. You will first directly invoke the Yahoo Weather API. Then you will import and deploy a simple API proxy that is provided as a sample on Github. </p>

<h3>Step 1: Invoke the Weather API directly</h3>

<p>In this example, you create an API proxy for Yahoo's Weather API. </p>
	
<p>Begin by invoking the API directly:</p>
<pre>$ curl http://weather.yahooapis.com/forecastrss?w=12797282</pre>

<p><b>Sample Response</b></p>
<pre>&lt;title&gt;Yahoo! Weather - Palo Alto, CA&lt;/title&gt;
&lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/Palo_Alto__CA/*http://weather.yahoo.com/forecast/USCA1093_f.html&lt;/link&gt;&lt;description&gt;Yahoo! Weather for Palo Alto, CA&lt;/description&gt;
&lt;language&gt;en-us&lt;/language&gt;
&lt;lastBuildDate&gt;Wed, 08 Aug 2012 9:47 am PDT&lt;/lastBuildDate&gt;
&lt;ttl&gt;60&lt;/ttl&gt;
&lt;yweather:location city="Palo Alto" region="CA"   country="United States"/&gt;
&lt;yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/&gt;
&lt;yweather:wind chill="66"   direction="10"   speed="8" /&gt;
&lt;yweather:atmosphere humidity="73"  visibility=""  pressure="30.02"  rising="0" /&gt;
&lt;yweather:astronomy sunrise="6:18 am"   sunset="8:08 pm"/&gt;</pre>

<h3>Step 2: Import and deploy simpleProxy to the API Platform</h3>

<p>This step refers to the simpleProxy available in the API Platform samples distribution. refer to [node:4561] for details and downloading instructions.</p>

<p>The simpleProxy is the most basic API proxy supported on the API Platform. It defines:</p>
<ul><li>A name for the API: <code>weatherapi</code></li>
<li>A target URL: <code>http://weather.yahooapis.com</code> (which the API platform uses to consume the Yahoo Weather API)</li>
<li>A proxy URL: <code>weather</code> (which client apps use to consume your API)</li></ul>

<p>Such API proxies are commonly referred to as "passthrough" proxies, since they merely forward requests and return responses without manipulating them.</p>

<p>If you have not done so, download the API platform samples:</p>

<pre>$ git clone https://github.com/apigee/api-platform-samples.git</pre>

<p>Navigate to the distribution contents:</p>

<pre>$ cd api-platform-samples</pre>

<p>Under <code>api-platform-samples</code> note the directory called <code>simpleProxy</code>. 

<pre>$ cd simpleProxy</pre>

<p>Under <code>simpleProxy</code> note the directory called <code>apiproxy</code>.

<p>The <code>apiproxy</code> directory contains the complete, fully functional definition of an API proxy. API proxy configuration files are always stored under a directory call <code>apiproxy</code>, and they define a directory structure that you must use in all API proxies.</p>

<p>You don't need this level of detail to get up and running, but keep in mind that you can always refer to the [node:8407] for an explanation of configuration elements.</p>
	
<p>For now, you can explore the configuration files to get a sense of what makes up an API proxy. (You don't need to change anything for the sample to work.)</p>

<p>You have several options for importing and deploying API proxies to your organization on the API Platform:</p>

<ul><li>The 'Upload Revision' feature in the API detail view of the <a href'enterprise.apigee.com'>Management UI</a>.</li>
<li>A direct API call to the RESTful API exposed by the API Platform. See [node:8300].</li>
<li>The Apigee Python deploy tool</li>
<li>A shell script that calls the Apigee Python deploy tool</li></ul>

<p>Note that the Apigee Python deploy tool calls the RESTful API exposed by the API platform. The deploy tool provides some important ease-of-use functions to make your life easier as you iteratively develop API proxies. It creates a valid ZIP file, performs some simple revision management, and deploys your API proxy to an environment--all in one step.</p>

<p>For the paths in the command below to work, the deploy tool must be run from the base directory in the API Platform samples distribution. You provide a pointer to the directory that contains the <code>/apiproxy</code> directory, in this case <code>simpleProxy</code>.</p>

<p><b>Note:</b> The <code>-d</code> flag must point to the directory that contains the <code>apiproxy</code> directory.</p>

<p>Substitute your username, password, and Apigee organization in the following command for <code>myname:mypass</code> and <code>myorg</code>.</p>

<p>For example, from the base directory of <code>api-platform-samples</code>, run:</p>

<pre>$ python tools/deploy.py -n weatherapi -u myname:mypass -o myorg -e test -p / -d simpleProxy</pre>

<p>This single action zips your files, pushes them to your organization on Apigee, and deploys them to the specified environment.</p>
<p>On success you see:</p>
<pre>Writing ./simpleProxy/apiproxy/weatherapi.xml to apiproxy/weatherapi.xml
Writing ./simpleProxy/apiproxy/proxies/default.xml to apiproxy/proxies/default.xml
Writing ./simpleProxy/apiproxy/targets/default.xml to apiproxy/targets/default.xml
Imported new proxy version 1
Environment: test
  Revision: 1 BasePath = /
  State: deployed</pre>

<p>The tool has zipped up your files, imported the package to Apigee, and deployed to the 'test' environment in your Apigee organization.</p>

<p>Your API is ready to be invoked.</p>

<h3>Step 3: Invoke the proxied Weather API</h3>

<p>Substitute your organization name for <code>{org_name}</code> in the request below:</p>

<pre>$ curl http://{org_name}-test.apigee.net/weather/forecastrss?w=12797282</pre>

<p>You can also paste the following into a Web browser:</p>

<pre>http://{org_name}-test.apigee.net/weather/forecastrss?w=12797282</pre>

<p>Sample Response</p>

	<pre>&lt;title&gt;Yahoo! Weather - Palo Alto, CA&lt;/title&gt;
&lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/Palo_Alto__CA/*http://weather.yahoo.com/forecast/USCA1093_f.html&lt;/link&gt;&lt;description&gt;Yahoo! Weather for Palo Alto, CA&lt;/description&gt;
&lt;language&gt;en-us&lt;/language&gt;
&lt;lastBuildDate&gt;Wed, 08 Aug 2012 9:47 am PDT&lt;/lastBuildDate&gt;
&lt;ttl&gt;60&lt;/ttl&gt;
&lt;yweather:location city="Palo Alto" region="CA"   country="United States"/&gt;
&lt;yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/&gt;
&lt;yweather:wind chill="66"   direction="10"   speed="8" /&gt;
&lt;yweather:atmosphere humidity="73"  visibility=""  pressure="30.02"  rising="0" /&gt;
&lt;yweather:astronomy sunrise="6:18 am"   sunset="8:08 pm"/&gt;</pre>

<h2>Working with APIs</h2>

<p>You have now created, deployed and invoked a basic API proxy. Now you will call some RESTful APIs that are exposed by teh API Platform to enable API management. These APIs are useful for exploring, debugging, and scripting the API proxy development lifecycle.</p>

<h3>List APIs in your organization</h3>

<pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/apis</pre>

<p>Sample Response:</p>
<pre>[ "weatherapi" ]</pre>

<h3>Get an API</h3>

<p>You can call the GET method on an API. This call returns a list of all available revisions of the API proxy.</p>
	
<pre>$ curl -u myname:mypass -H "Accept: application/json" https://api.enterprise.apigee.com/v1/o/{org_name}/apis/weatherapi</pre>
	
<p>Sample Response:</p>

<pre>{
  "name" : "weatherapi",
  "revision" : [ "1" ]
}</pre>

<p>The only detail we get is the name of the API along with a 'revision', which in turn has a number. </p>

<p>There is only one revision because you just created this API. As an API moves through the lifecycle of iterative configuration and deployment, the version number increments by integers.</p>

<h3>Get API Revision</h3>

<p>To obtain the detailed profile of an API configuration, you view a specific revision number.</p>

<p>For example, you can call the GET method on  API proxy revision 1 to get a detailed view.</p>

<pre>$ curl -u myname:mypass -H "Accept:application/json" https://api.enterprise.apigee.com/v1/o/{org_name}/apis/weatherapi/revisions/1</pre>
<p><b>Sample Response</b></p>
<pre>{
  "configurationVersion" : {
    "majorVersion" : 4,
    "minorVersion" : 0
  },
  "contextInfo" : "Revision 1 of application weatherapi, in organization {org_name}",
  "createdAt" : 1343178905169,
  "createdBy" : "andrew@apigee.com",
  "lastModifiedAt" : 1343178905169,
  "lastModifiedBy" : "andrew@apigee.com",
  "name" : "weatherapi",
  "policies" : [ ],
  "proxyEndpoints" : [ ],
  "resources" : [ ],
  "revision" : "1",
  "targetEndpoints" : [ ],
  "targetServers" : [ ],
  "type" : "Application"
}</pre>

<p>You can see here that all of the important pieces of the API are empty. There are no policies, no Endpoints, no resources. You will add these to your API in the next Developer Guide topics. You can also read about these configuration elements in the [node:8407].)</p>

<h3>Deploying an API to an environment</h3>

<p>Now that your API proxy is configured to receive and forward requests properly, you can deploy it to one or more environments. Usually, you iterate on API proxies in 'test' and then, when ready, you deploy an API proxy to 'prod'. You then publish the 'prod' URL to external developers.</p>
	
<p><b>Note:</b> An API proxy cannot be invoked until is has been deployed.</p>
<p>You deploy the API <b>revision</b> to an environment. First, check environments in your organization.</p>

<h3>How to List Environments</h3>

<p>Every organization on the API Platform has at least two environments: 'test' and 'prod'. The distinction is arbitrary. The goal is to provide you with an area to verify that your API proxy is working properly before you open it up to outside developers. Each environment is really just a network address, enabling you segregate traffic between the API proxies that you are working on, and those that are being accessed by apps at runtime.</p>

<h3>View environments in an organization</h3>

<pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/environments</pre>
<p>Sample Response</p>

<pre>[ "test", "prod" ]</pre>

<h3>Deploy your API to the Test Environment</h3>

<p>Now, deploy the API to the test environment</p>

<pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/apis/weatherapi/revisions/1/deployments?action=deploy&env=test&basepath=/</pre>

<p>Sample Response</p>

<pre>{
  "aPIProxy" : "weatherapi",
  "environment" : [ test ],
  "name" : "1",
  "organization" : "{org_name}"
}</pre>


<h3>Explore Deployments</h3>

<p>A "deployment" is a deployed revision of your API. It is often useful to check to see in which environment (and if!) your API is deployed. </p>

<p>For example, you might find requests to your API proxy are failing. One troubleshooting step is to ensure that the API is deployed as expected.</p>

<h3>See All Deployments of an API Revision</h3>
<div id="well"><pre>curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/apis/weatherapi/revision/1/deployments</pre></div>

<pre>{
  "aPIProxy" : "weatherapi",
  "environment" : [ {
    "configuration" : {
      "basePath" : "",
      "steps" : [ ]
    },
    "name" : "test",
    "server" : [ {
      "status" : "deployed",
      "type" : [ "message-processor" ],
      "uUID" : "90096dd1-1019-406b-9f42-fbb80cd01200"
    }, {
      "status" : "deployed",
      "type" : [ "message-processor" ],
      "uUID" : "7d6e2eb1-581a-4db0-8045-20d9c3306549"
    }, {
      "status" : "deployed",
      "type" : [ "router" ],
      "uUID" : "1619e2d7-c822-45e0-9f97-63882fb6a805"
    }, {
      "status" : "deployed",
      "type" : [ "router" ],
      "uUID" : "8a5f3d5f-46f8-4e99-b4cc-955875c8a8c8"
    } ],
    "state" : "deployed"
  } ],
  "name" : "1",
  "organization" : "org_name"
}</pre>

<h3>See All Deployments in the Test Environment</h3>
<pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/environments/test/deployments</pre>

<p>Returns the same result as above for every API deployed in the test environment
</p>

<h3>See All Deployments in your organization</h3>
<pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{org_name}/deployments</pre>
<p>Returns the same result as above for all API proxies deployed in all environments.
</p>

<p>Since the API is RESTful, you can simply use the POST method, along with a JSON or XML payload, against the same resource to create an API proxy.</p>

<p>A profile for your API proxy is generated on the API Platform. The default representation of an API proxy is JavaScript object notation (JSON). Below is the default JSON response to the POST request above, which created an API proxy called 'weatherapi'. A description of each element in the profile follows:</p>

	<pre>{
  "configurationVersion" : {
    "majorVersion" : 4,
    "minorVersion" : 0
  },
  "contextInfo" : "Revision 1 of application weatherapi, in organization {org_name}",
  "createdAt" : 1357172145444,
  "createdBy" : "you@yourcompany.com",
  "displayName" : "weatherapi",
  "lastModifiedAt" : 1357172145444,
  "lastModifiedBy" : "you@yourcompany.com",
  "name" : "weatherapi",
  "policies" : [ ],
  "proxyEndpoints" : [ ],
  "resources" : [ ],
  "revision" : "1",
  "targetEndpoints" : [ ],
  "targetServers" : [ ],
  "type" : "Application"
}</pre>
	
<p><span class="label label-info">Note</span> Keep in mind that the response payload merely contains a representation of an API resource--you can create an API proxy using JSON or XML, and you can also retrieve representations of the API proxy as XML or JSON, depending on your needs.</p>

<p>The API proxy profile that is generated demonstrates the complete structure of an API proxy:</p>
<ul>
	<li><code>APIProxy revision</code>: The sequentially numbered iteration of the API proxy configuration, as maintained by the API Platform</li>
	<li><code>APIProxy name</code>: The unique name of the API proxy</li>
	<li><code>ConfigurationVersion</code>: API Platform version to which the API proxy configuration conforms</li>
	<li><code>CreatedAt</code>: Time when the API proxy was generated on the API platform, formatted in UNIX time</li>
	<li><code>CreatedBy</code>: Email address of the Apigee user who created the API proxy</li>
	<li><code>DisplayName</code>: A user-friendly name for the API proxy</li>
	<li><code>LastModifiedAt</code>: Time when the API proxy was generated on the API platform, formatted in UNIX time</li>
	<li><code>LastModifiedBy</code>: Email address of the Apigee user who created the API proxy on the API platform</li>
	<li><code>Policies</code>: A list of policies that have been added to this API proxy</li>
	<li><code>ProxyEndpoints</code>: A list of named ProxyEndpoints</li>
	<li><code>Resources</code>: A list of resources (JavaScript, Python, Java, XSLT) available to be executed in this API proxy</li>
	<li><code>TargetServers</code>: A list of named TargetServers (that can be created using the APi Platform API), used in advanced configurations for load balancing purposes</li>
	<li><code>TargetEndpoints</code>: A list of named TargetEndpoints</li>
</ul>

<p>Note that many of the elements of the API proxy configuration created using the simple POST method above are empty. In the following Developer Guide topics, you will learn how to add and configure the key components of an API proxy.</p>


<h3>Invoking an API proxy</h3>

<p>After you deploy an API proxy to the API Platform, it can be invoked over the network. A set of URLs is created for each environment in your organization. The URLs are defined in a VirtualHost definition file that is stored in the environment. The default URL includes your organization name combined with the environment name and an Apigee-specific domain.</p>

<p>The proxied URL consists of:</p>
<ul>
	<li>Organization name: The name of the organization in which you have an account on the API Platform</li>
	<li>The environment name: The name of the environment where you want run the API proxy (usually either 'test' or 'prod')</li>
	<li>The Apigee proxy base URL (<code>apigee.net</code>, NOT <code>api.enterprise.apigee.com</code>)</li>
	<li>The base path URI fragment you configure for the API proxy (in the example above, <code>/weather</code>)</li>
</ul>

<p>The URL for the API proxy in this example is:</p>

<pre>http://{org_name}-test.apigee.net/weather</pre>

<p>For an organization called 'apifactory', the API proxy address is:</p>

<pre>http://apifactory-test.apigee.net/weather</pre>

<p>This is the address that you use to call the API at runtime. For example, if you are building an app, you configure the app to call this URL.</p>

<p>So to invoke an API proxy with a complete functional request, clients submit requests to:</p>

<pre>$ curl http://{org_name}-{env_name}.apigee.net/weather/forecastrss?w=12797282</pre>

<p>The API Platform takes the URI path following the base path (defined in the ProxyEndpoint) and appends the value to the URL defined in the HTTPConnection for the TargetEndpoint. This results in an outbound call to the backend service:</p>

<div id="well"><pre>http://weather.yahooapis.com/forecastrss?w=12797282</pre></div>

<p>The API Platform receives the response and returns the response to the client app.</p>

<p>Post questions to the <a href="http://support.apigee.com">Apigee Developer Forum</a>.</p>

<p>Back to <a href="/docs/enterprise/content/developer_guide">API Platform Developer Guide</a>.</p>
